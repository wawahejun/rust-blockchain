# B2区块链项目

## 项目简介

B2是一个基于Rust实现的简易区块链系统，具有区块生成、挖矿、交易签名验证、P2P网络同步等基本功能。该项目实现了区块链的核心概念，包括工作量证明(PoW)、默克尔树、数字签名等，适合用于学习区块链的基本原理和Rust编程。

## 代码结构

```
src/
├── block.rs         // 区块结构及相关功能
├── blockchain.rs    // 区块链结构及链管理
├── main.rs          // 程序入口
├── merkle_tree.rs   // 默克尔树实现
├── node.rs          // P2P网络节点
├── pow.rs           // 工作量证明(PoW)算法
├── transaction.rs   // 交易结构及签名验证
└── utils.rs         // 通用工具函数
```

## 核心功能

### 1. 区块与区块链 (block.rs, blockchain.rs)

区块链的基本单位是区块(Block)，每个区块包含以下关键信息：
- 区块索引(index)：区块在链中的位置
- 时间戳(timestamp)：区块创建时间
- 交易列表(transactions)：包含在该区块中的所有交易
- 前一个区块的哈希值(previous_hash)：保证链式结构
- 当前区块的哈希值(hash)：区块数据的唯一标识
- 随机数(nonce)：用于工作量证明的随机值
- 默克尔树根(merkle_root)：所有交易的默克尔树根哈希

区块链(Blockchain)管理整个区块的链式结构，提供以下功能：
- 创建创世区块：链的第一个区块
- 添加新区块：挖掘并添加新的区块到链中
- 验证区块链的完整性：检查链中所有区块的哈希值和前一区块的哈希值是否匹配

### 2. 交易与签名 (transaction.rs)

交易(Transaction)是区块链上的基本操作单元，包含：
- 发送方(sender)：交易发起者的公钥
- 接收方(receiver)：交易接收者的公钥
- 金额(amount)：交易数量
- 签名(signature)：使用发送方私钥生成的数字签名

该模块提供以下功能：
- 创建新交易：生成交易并使用私钥签名
- 验证交易签名：确保交易的合法性
- 生成密钥对：使用Ed25519算法生成公私钥对

### 3. 默克尔树 (merkle_tree.rs)

默克尔树(Merkle Tree)是一种哈希树，用于高效验证大量数据的完整性：
- 将交易数据转换为叶子节点
- 对相邻节点进行配对并计算哈希值，形成父节点
- 重复上述过程直到生成根节点(merkle_root)
- 通过根哈希值可以快速验证交易数据是否被篡改

### 4. P2P网络节点 (node.rs)

网络节点(Node)实现了区块链的分布式特性：
- 每个节点维护自己的区块链副本
- 节点之间可以互相连接，形成P2P网络
- 提供区块链同步功能，确保网络一致性

### 5. 工作量证明 (pow.rs, block.rs)

工作量证明(Proof of Work)是一种共识算法：
- 通过调整nonce值，使区块哈希值满足特定条件(前缀包含指定数量的0)
- 难度(difficulty)决定了挖矿的复杂程度
- 成功计算出满足条件的哈希值后，区块被认为已被"挖出"

### 6. 工具函数 (utils.rs)

提供常用工具函数：
- JSON序列化：将数据转换为JSON格式
- 哈希计算：计算数据的SHA-256哈希值

## 使用方法

程序入口在`main.rs`中，演示了以下流程：
1. 生成Alice和Bob的密钥对
2. 创建两个网络节点并相互连接
3. 通过Alice创建一笔向Bob转账的交易
4. 将交易打包到区块中并挖矿
5. 同步区块链到其他节点
6. 打印两个节点上的区块链状态

## 技术栈

- Rust语言
- chrono：时间处理
- serde：序列化/反序列化
- sha2：哈希算法
- ring：加密和签名
- hex：十六进制编码

## 扩展方向

该项目实现了区块链的基本功能，可以在此基础上进行以下扩展：
1. 实现完整的P2P网络通信，包括节点发现、区块广播等
2. 添加UTXO(未花费交易输出)模型或账户模型
3. 实现更高效的共识算法，如PoS(权益证明)
4. 添加智能合约功能
5. 优化存储结构，使用数据库存储区块链数据
6. 实现钱包功能，管理用户的密钥和资产
