# B3 区块链框架

## 项目概述

B3是一个用Rust编写的轻量级区块链框架，实现了区块链的核心功能，包括区块创建、挖矿、交易处理、智能合约和隐私交易等功能。该项目适合用于学习区块链原理和开发区块链应用。

## 代码结构

```
src/
├── main.rs          # 程序入口点
├── block.rs         # 区块结构定义和实现
├── blockchain.rs    # 区块链核心逻辑
├── transaction.rs   # 交易相关功能
├── merkle_tree.rs   # 默克尔树实现
├── wallet.rs        # 钱包实现
├── node.rs          # P2P网络节点
├── cli.rs           # 命令行接口
├── smart_contract.rs # 简单智能合约实现
├── privacy.rs       # 隐私交易实现
├── pow.rs           # 工作量证明算法
└── utils.rs         # 工具函数
```

## 核心功能

### 区块结构 (block.rs)

区块是区块链的基本组成单位，包含以下属性：
- 索引：区块在链中的位置
- 时间戳：区块创建时间
- 交易列表：包含在区块中的所有交易
- 前一个区块的哈希值：确保区块链的完整性
- 当前区块的哈希值：基于区块内容计算
- 随机数(nonce)：用于挖矿(工作量证明)
- 默克尔根：所有交易的根哈希，保证交易数据的完整性

区块提供以下功能：
- 创建新区块
- 计算区块哈希
- 挖矿(工作量证明)

### 区块链 (blockchain.rs)

区块链是由一系列区块组成的分布式账本，主要功能包括：
- 创建新的区块链(包括创世区块)
- 添加新区块
- 验证区块链的完整性
- 余额管理
- 交易验证
- 智能合约部署和执行
- 隐私交易支持
- 区块链的保存和加载

### 交易 (transaction.rs)

交易描述了价值在不同地址之间的转移，包含以下属性：
- 发送方地址
- 接收方地址
- 金额
- 签名

交易提供以下功能：
- 创建新交易
- 对交易进行签名
- 验证交易的签名有效性
- 生成用于签名和验证的消息

### 默克尔树 (merkle_tree.rs)

默克尔树是一种哈希树，用于高效验证大量数据的完整性，主要功能包括：
- 从交易列表构建默克尔树
- 计算默克尔根
- 处理哈希计算

### 钱包 (wallet.rs)

钱包用于管理用户的密钥对和地址，提供以下功能：
- 创建新钱包
- 生成地址(公钥)
- 签名数据
- 验证签名

### 网络节点 (node.rs)

网络节点代表区块链网络中的一个参与者，主要功能包括：
- 创建新节点
- 添加对等节点
- 同步区块链数据

### 命令行接口 (cli.rs)

命令行接口提供与区块链交互的方式，主要功能包括：
- 创建钱包
- 发起交易
- 挖矿新区块
- 验证区块链
- 部署智能合约
- 执行智能合约
- 创建隐私交易
- 查询和设置地址余额

### 智能合约 (smart_contract.rs)

智能合约是自动执行的协议，主要功能包括：
- 创建新合约
- 执行合约方法
- 管理合约状态

### 隐私交易 (privacy.rs)

隐私交易通过零知识证明保护交易隐私，主要功能包括：
- 创建隐私交易
- 验证隐私交易的有效性

### 工作量证明 (pow.rs)

工作量证明是一种共识机制，通过解决计算难题来验证区块有效性，主要功能包括：
- 实现工作量证明算法
- 调整难度级别

### 工具函数 (utils.rs)

工具函数提供通用的辅助功能，包括：
- 数据JSON格式化
- 哈希计算

## 使用方法

### 编译项目

```bash
cargo build --release
```

### 运行命令行工具

```bash
# 创建钱包
cargo run -- create-wallet

# 发起交易
cargo run -- add-transaction --sender <发送方地址> --receiver <接收方地址> --amount <金额>

# 挖矿
cargo run -- mine-block --miner <挖矿地址>

# 验证区块链
cargo run -- validate-chain

# 部署智能合约
cargo run -- deploy-contract --contract-id <合约ID> --code <合约代码>

# 执行智能合约
cargo run -- execute-contract --contract-id <合约ID> --method <方法名> --args <参数1> <参数2>

# 创建隐私交易
cargo run -- create-privacy-transaction --amount <金额>

# 查询余额
cargo run -- get-balance --address <钱包地址>
```

## 项目特点

1. **模块化设计**: 每个组件都有明确的职责，易于扩展和维护
2. **完整功能**: 实现了区块链的核心功能，包括区块、交易、挖矿、验证等
3. **智能合约支持**: 提供基本的智能合约功能
4. **隐私保护**: 通过零知识证明支持隐私交易
5. **命令行工具**: 提供友好的命令行接口，方便与区块链交互

## 未来扩展

1. 改进共识机制，如实现权益证明(PoS)
2. 增强智能合约功能，支持更复杂的应用
3. 完善P2P网络模块，实现真正的分布式网络
4. 优化存储方式，提高性能和扩展性
5. 增加更多隐私保护特性
